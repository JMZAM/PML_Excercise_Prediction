{"name":"PML Excercise prediction","tagline":"","body":"# Prediction Assignment\r\nJuan M Zambrano  \r\nOctober 2015  \r\n\r\n#Project overview\r\n\r\nAccording to the projectÂ´s instructions:\r\n\r\n>Using devices such as Jawbone Up, Nike FuelBand, and Fitbit it is now possible to collect a large amount of data about personal activity relatively inexpensively. These type of devices are part of the quantified self movement - a group of enthusiasts who take measurements about themselves regularly to improve their health, to find patterns in their behavior, or because they are tech geeks. One thing that people regularly do is quantify how much of a particular activity they do, but they rarely quantify how well they do it. In this project, your goal will be to use data from accelerometers on the belt, forearm, arm, and dumbell of 6 participants. They were asked to perform barbell lifts correctly and incorrectly in 5 different ways. More information is available from the [website](http://groupware.les.inf.puc-rio.br/har) (see the section on the Weight Lifting Exercise Dataset).\r\n\r\nThe [training](https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv) and [test](https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv) sets were provided.\r\n\r\n#Goal\r\nTo use data from accelerometers on the belt, forearm, arm and dumbell of 6 participants asked to perform barbell lifts in 5 different ways to predict the way in which they did the excercise.\r\n\r\n# Initial data loading and creation of test and validation sets\r\n\r\n\r\n```r\r\n#First the packages that will be used are loaded\r\nlibrary(caret)\r\nlibrary(randomForest)\r\nlibrary(class)\r\nlibrary(nnet)\r\n\r\n#The training and test data sets are loaded\r\npml.training <- read.csv(\"./pml-training.csv\", row.names=1, stringsAsFactors = FALSE)\r\npml.testing <- read.csv(\"./pml-testing.csv\", row.names=1, stringsAsFactors = FALSE)\r\n\r\n#The supplied training set is subdivided into training and validation sets\r\nset.seed(1991991)\r\ntraindata <- createDataPartition(pml.training$classe, p = 0.8, list = FALSE)\r\ntraining <- pml.training[traindata, ]\r\nvalidation <- pml.training[-traindata, ]\r\n```\r\n\r\n#Preprocessing\r\n\r\nFor feature selection, several parameters were taken into account:\r\n\r\nVariable rule | Number of variables excluded for this reason\r\n----|----\r\n1. Descriptive variables were excluded from the analysis (i.e. variables that described the participant name, event time and date, etc.)| 6\r\n2. Variables that had less than 5% of values different from zero or NA were excluded | 106\r\n3. Variables with near nonzero variance were excluded.| 0\r\n\r\n```r\r\n#character descriptive variables \r\ncharvars <- c(\"user_name\",\"raw_timestamp_part_1\",\"raw_timestamp_part_2\", \"cvtd_timestamp\", \"new_window\", \"num_window\")\r\n\r\n#variables with excess NA or black values\r\nnablankcount <- sapply(training, function(x) sum((is.na(x) | x == \"\"))) #counts the number of NA/blanks per column\r\nnablankcols <- names(nablankcount[nablankcount > 0.05*dim(training)[1]]) #names for variables with more than 5% NA/blank values\r\ntraining2 <- training[,!names(training) %in% c(charvars,nablankcols)]\r\n\r\n#variables with near zero variance\r\nnear0var<- nearZeroVar(training2)\r\nif (length(near0var)> 0) training2<- training2[,-near0var]\r\n\r\n#The selected features are uptated to the validation set\r\nfinalcols<-names(training2)\r\nvalidation2 <- validation[,names(training2)]\r\n```\r\n\r\n#Model fitting \r\nAfter reviewing several of the machine learning techniques that were introduced in class, along with others observed while studying the options in the caret package, I decided to include 4 types of algorithms to compare and choose the one with the best accuracy in classification when evaluating the out-of-sample error with the validation set. That is, models with accuracy > 95%. The train algorithm within the caret package uses by default the accuracy and kappa parameters for model selection (cross validation).\r\n\r\nThe first model attempted is a classification tree model:\r\n\r\n```r\r\nmodFit <- train(as.factor(classe) ~ ., method =\"rpart\", data=training2, trControl = trainControl(method=\"cv\"))\r\n```\r\n\r\n```\r\n## Loading required namespace: e1071\r\n```\r\n\r\n```r\r\nptraining <- predict(modFit, validation2)\r\nconfusionMatrix(ptraining, validation2$classe)\r\n```\r\n\r\n```\r\n## Confusion Matrix and Statistics\r\n## \r\n##           Reference\r\n## Prediction    A    B    C    D    E\r\n##          A 1019  335  323  292  110\r\n##          B   17  228   23  112   90\r\n##          C   80  196  338  239  195\r\n##          D    0    0    0    0    0\r\n##          E    0    0    0    0  326\r\n## \r\n## Overall Statistics\r\n##                                           \r\n##                Accuracy : 0.4871          \r\n##                  95% CI : (0.4714, 0.5029)\r\n##     No Information Rate : 0.2845          \r\n##     P-Value [Acc > NIR] : < 2.2e-16       \r\n##                                           \r\n##                   Kappa : 0.3289          \r\n##  Mcnemar's Test P-Value : NA              \r\n## \r\n## Statistics by Class:\r\n## \r\n##                      Class: A Class: B Class: C Class: D Class: E\r\n## Sensitivity            0.9131  0.30040  0.49415   0.0000   0.4521\r\n## Specificity            0.6224  0.92351  0.78080   1.0000   1.0000\r\n## Pos Pred Value         0.4901  0.48511  0.32252      NaN   1.0000\r\n## Neg Pred Value         0.9474  0.84622  0.87965   0.8361   0.8902\r\n## Prevalence             0.2845  0.19347  0.17436   0.1639   0.1838\r\n## Detection Rate         0.2598  0.05812  0.08616   0.0000   0.0831\r\n## Detection Prevalence   0.5300  0.11981  0.26714   0.0000   0.0831\r\n## Balanced Accuracy      0.7677  0.61195  0.63747   0.5000   0.7261\r\n```\r\nAs we can see, the accuracy is very low (48.71%); for this reason the model will be discarded.\r\nThe second model is a single-hidden-layer neural network. We will use a maximum of 1000 iterations for time considerations.\r\n\r\n```r\r\nmodFit2 <- nnet(as.factor(classe)~., data=training2, size = 17, decay = 5e-4, maxit = 1000)\r\n```\r\n\r\n```\r\n## # weights:  991\r\n## initial  value 33673.300036 \r\n## iter  10 value 22691.761091\r\n## iter  20 value 21847.599347\r\n## iter  30 value 21265.107361\r\n## iter  40 value 20654.274834\r\n## iter  50 value 20262.791545\r\n## iter  60 value 19919.662994\r\n## iter  70 value 19661.567214\r\n## iter  80 value 19408.599568\r\n## iter  90 value 18993.272933\r\n## iter 100 value 18733.308901\r\n## iter 110 value 18252.452766\r\n## iter 120 value 17850.261296\r\n## iter 130 value 17611.439885\r\n## iter 140 value 17388.097943\r\n## iter 150 value 17244.000297\r\n## iter 160 value 17104.982919\r\n## iter 170 value 16909.056823\r\n## iter 180 value 16776.100006\r\n## iter 190 value 16549.962531\r\n## iter 200 value 16369.305983\r\n## iter 210 value 16233.548337\r\n## iter 220 value 16115.475770\r\n## iter 230 value 16040.870853\r\n## iter 240 value 15918.249529\r\n## iter 250 value 15777.678053\r\n## iter 260 value 15644.226408\r\n## iter 270 value 15547.668271\r\n## iter 280 value 15388.684110\r\n## iter 290 value 15241.464646\r\n## iter 300 value 15162.367083\r\n## iter 310 value 15051.969632\r\n## iter 320 value 14938.183849\r\n## iter 330 value 14787.009926\r\n## iter 340 value 14639.919577\r\n## iter 350 value 14553.243056\r\n## iter 360 value 14430.040223\r\n## iter 370 value 14354.801717\r\n## iter 380 value 14247.105311\r\n## iter 390 value 14192.135633\r\n## iter 400 value 14113.643788\r\n## iter 410 value 14041.545568\r\n## iter 420 value 13962.609623\r\n## iter 430 value 13892.075609\r\n## iter 440 value 13834.211625\r\n## iter 450 value 13781.625770\r\n## iter 460 value 13724.211062\r\n## iter 470 value 13688.152173\r\n## iter 480 value 13654.596613\r\n## iter 490 value 13626.667697\r\n## iter 500 value 13592.951207\r\n## iter 510 value 13566.907382\r\n## iter 520 value 13543.725073\r\n## iter 530 value 13530.124974\r\n## iter 540 value 13516.530930\r\n## iter 550 value 13500.933312\r\n## iter 560 value 13496.249340\r\n## iter 570 value 13487.793780\r\n## iter 580 value 13483.223783\r\n## iter 590 value 13480.294457\r\n## iter 600 value 13476.582962\r\n## iter 610 value 13474.368201\r\n## iter 620 value 13471.650329\r\n## iter 630 value 13471.238091\r\n## iter 640 value 13470.317147\r\n## iter 650 value 13463.211708\r\n## iter 660 value 13461.554825\r\n## iter 670 value 13460.461198\r\n## iter 680 value 13459.706755\r\n## iter 690 value 13459.345756\r\n## iter 700 value 13458.767287\r\n## iter 710 value 13458.436818\r\n## iter 720 value 13457.862327\r\n## iter 730 value 13457.362059\r\n## iter 740 value 13456.182867\r\n## iter 750 value 13452.927726\r\n## iter 760 value 13451.329744\r\n## iter 770 value 13448.955501\r\n## iter 780 value 13448.521672\r\n## iter 790 value 13447.435577\r\n## iter 800 value 13446.113477\r\n## iter 810 value 13445.690862\r\n## iter 820 value 13445.171429\r\n## iter 830 value 13444.954042\r\n## iter 840 value 13444.583287\r\n## iter 850 value 13444.226226\r\n## iter 860 value 13443.834208\r\n## iter 870 value 13443.714975\r\n## iter 880 value 13443.599699\r\n## iter 890 value 13442.826183\r\n## iter 900 value 13442.730310\r\n## iter 910 value 13442.693601\r\n## iter 920 value 13441.626628\r\n## iter 930 value 13440.579911\r\n## iter 940 value 13437.503938\r\n## iter 950 value 13436.339121\r\n## iter 960 value 13435.605067\r\n## iter 970 value 13434.356017\r\n## iter 980 value 13433.974406\r\n## iter 990 value 13433.741257\r\n## iter1000 value 13433.317277\r\n## final  value 13433.317277 \r\n## stopped after 1000 iterations\r\n```\r\n\r\n```r\r\nptraining2 <- predict(modFit2, validation2, type=\"class\")\r\nconfusionMatrix(ptraining2, validation2$classe)\r\n```\r\n\r\n```\r\n## Confusion Matrix and Statistics\r\n## \r\n##           Reference\r\n## Prediction   A   B   C   D   E\r\n##          A 945 157  53  75  32\r\n##          B  42 390  52  37 110\r\n##          C  47  67 422  92  93\r\n##          D  49  30 100 405  68\r\n##          E  33 115  57  34 418\r\n## \r\n## Overall Statistics\r\n##                                           \r\n##                Accuracy : 0.6577          \r\n##                  95% CI : (0.6426, 0.6725)\r\n##     No Information Rate : 0.2845          \r\n##     P-Value [Acc > NIR] : < 2.2e-16       \r\n##                                           \r\n##                   Kappa : 0.5652          \r\n##  Mcnemar's Test P-Value : 4.681e-16       \r\n## \r\n## Statistics by Class:\r\n## \r\n##                      Class: A Class: B Class: C Class: D Class: E\r\n## Sensitivity            0.8468  0.51383   0.6170   0.6299   0.5798\r\n## Specificity            0.8871  0.92383   0.9077   0.9247   0.9254\r\n## Pos Pred Value         0.7488  0.61807   0.5853   0.6212   0.6362\r\n## Neg Pred Value         0.9357  0.88791   0.9182   0.9272   0.9072\r\n## Prevalence             0.2845  0.19347   0.1744   0.1639   0.1838\r\n## Detection Rate         0.2409  0.09941   0.1076   0.1032   0.1066\r\n## Detection Prevalence   0.3217  0.16085   0.1838   0.1662   0.1675\r\n## Balanced Accuracy      0.8669  0.71883   0.7623   0.7773   0.7526\r\n```\r\nAs we can see, the accuracy has increased to 65.77%, however it is still unsatisfactory.\r\nThe third model is a k-nearest neighbour classification, which for each row of the test set finds the k nearest training vectors and decides classification upon majority vote. Given the amount of data, I will use k=1. \r\n\r\n```r\r\nptraining3 <- knn(training2[,-53], validation2[,-53], training2[,53], k = 1, prob = FALSE, use.all = TRUE)\r\nconfusionMatrix(ptraining3, validation2$classe)\r\n```\r\n\r\n```\r\n## Confusion Matrix and Statistics\r\n## \r\n##           Reference\r\n## Prediction    A    B    C    D    E\r\n##          A 1103   10    3    5    3\r\n##          B    3  731   11    2    8\r\n##          C    3   12  660   19    6\r\n##          D    6    2    6  612    6\r\n##          E    1    4    4    5  698\r\n## \r\n## Overall Statistics\r\n##                                           \r\n##                Accuracy : 0.9697          \r\n##                  95% CI : (0.9638, 0.9748)\r\n##     No Information Rate : 0.2845          \r\n##     P-Value [Acc > NIR] : <2e-16          \r\n##                                           \r\n##                   Kappa : 0.9616          \r\n##  Mcnemar's Test P-Value : 0.1977          \r\n## \r\n## Statistics by Class:\r\n## \r\n##                      Class: A Class: B Class: C Class: D Class: E\r\n## Sensitivity            0.9884   0.9631   0.9649   0.9518   0.9681\r\n## Specificity            0.9925   0.9924   0.9877   0.9939   0.9956\r\n## Pos Pred Value         0.9813   0.9682   0.9429   0.9684   0.9803\r\n## Neg Pred Value         0.9954   0.9912   0.9926   0.9906   0.9928\r\n## Prevalence             0.2845   0.1935   0.1744   0.1639   0.1838\r\n## Detection Rate         0.2812   0.1863   0.1682   0.1560   0.1779\r\n## Detection Prevalence   0.2865   0.1925   0.1784   0.1611   0.1815\r\n## Balanced Accuracy      0.9904   0.9778   0.9763   0.9728   0.9819\r\n```\r\nThe out-of-sample error has decreased significantly! This model gives us an accuracy of over 95%, to be exact 96.97%.\r\nThough we have achieved an acceptable performance, it is worth to try another algorithm, the random forest:\r\n\r\n```r\r\nmodFit4 <- randomForest(as.factor(classe) ~ ., data = training2, importance = TRUE, ntrees = 10, trControl = trainControl(method=\"cv\"))\r\nptraining4 <- predict(modFit4, validation2)\r\nconfusionMatrix(ptraining4, validation2$classe)\r\n```\r\n\r\n```\r\n## Confusion Matrix and Statistics\r\n## \r\n##           Reference\r\n## Prediction    A    B    C    D    E\r\n##          A 1116    3    0    0    0\r\n##          B    0  754    1    0    0\r\n##          C    0    2  682   10    0\r\n##          D    0    0    1  631    3\r\n##          E    0    0    0    2  718\r\n## \r\n## Overall Statistics\r\n##                                           \r\n##                Accuracy : 0.9944          \r\n##                  95% CI : (0.9915, 0.9965)\r\n##     No Information Rate : 0.2845          \r\n##     P-Value [Acc > NIR] : < 2.2e-16       \r\n##                                           \r\n##                   Kappa : 0.9929          \r\n##  Mcnemar's Test P-Value : NA              \r\n## \r\n## Statistics by Class:\r\n## \r\n##                      Class: A Class: B Class: C Class: D Class: E\r\n## Sensitivity            1.0000   0.9934   0.9971   0.9813   0.9958\r\n## Specificity            0.9989   0.9997   0.9963   0.9988   0.9994\r\n## Pos Pred Value         0.9973   0.9987   0.9827   0.9937   0.9972\r\n## Neg Pred Value         1.0000   0.9984   0.9994   0.9964   0.9991\r\n## Prevalence             0.2845   0.1935   0.1744   0.1639   0.1838\r\n## Detection Rate         0.2845   0.1922   0.1738   0.1608   0.1830\r\n## Detection Prevalence   0.2852   0.1925   0.1769   0.1619   0.1835\r\n## Balanced Accuracy      0.9995   0.9965   0.9967   0.9901   0.9976\r\n```\r\nAs we can see, this is the model with the highest accuracy, to be precise 99.44%. This is the model that I will choose for the predictions.\r\n\r\n#The final predictions\r\nIn conclusion, there seem to be two models with an adequate level of accuracy (k-nearest neighbour and random forest algorithms). We can use these two to predict the test data and identify possible differences.\r\n\r\n```r\r\ntest <- pml.testing[,names(pml.testing) %in% finalcols]\r\nknnpred <- knn(training2[,-53], test, training2[,53], k = 1, prob = FALSE, use.all = TRUE)\r\nrfpred <- predict(modFit4, test)\r\nsetdiff(knnpred,rfpred)\r\n```\r\n\r\n```\r\n## character(0)\r\n```\r\nThere are no differences!\r\nFor our purposes, we had decided on using the random forest model. The predictions are:\r\n\r\n```r\r\nrfpred\r\n```\r\n\r\n```\r\n##  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 \r\n##  B  A  B  A  A  E  D  B  A  A  B  C  B  A  E  E  A  B  B  B \r\n## Levels: A B C D E\r\n```\r\nwith a model with an out of sample error of ~0.56%.\r\n\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}